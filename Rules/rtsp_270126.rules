
#RTSP1 -> Many Describes in Short Time.
alert tcp $EXTERNAL_NET any -> $HOME_NET $RTSP_PORTS (msg:"RTSP Recon: viele DESCRIBE in kurzer Zeit"; flow:to_server,established; pcre:"/^DESCRIBE\s+\S+\s+RTSP\/1\.\d/i"; threshold:type both, track by_src, count 5, seconds 60; reference:cve,2024-51362; classtype:attempted-recon; sid:9000001; rev:2;)

#RTSP2 -> Many 404 Responeses from Server: Path Recon
alert tcp $HOME_NET 8554 -> any any (msg:"RTSP server excessive 400 responses"; flow:established,to_client; pcre:"/^RTSP\/1\.[01]\s+400\b/i"; detection_filter: track by_src, count 190, seconds 60; classtype:attempted-recon; sid:9000002; rev:1;)

#RTSP3 (Checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET $RTSP_PORTS (msg:"RTSP ANNOUNCE long/padded SDP attribute - possible buffer probe/overflow attempt";flow:to_server,established;content:"ANNOUNCE "; nocase; depth:9;content:"RTSP/1."; nocase; distance:0;content:"|0d 0a 0d 0a|";content:"a=long:"; distance:0;pcre:"/a=long:([A-Za-z0-9+\/=]{180,}|A{200,}|%00{3,})/smi";classtype:attempted-admin;sid:9000003; rev:4;)

#RTSP4 (Checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET $RTSP_PORTS (msg:"RTSP traversal in request-target (../)";flow:to_server,established;content:"RTSP/1."; nocase;pcre:"/(?:\srtsp:\/\/[^\r\n]*| \/[^\r\n]*)(?:\.\.\/){1,}[^\r\n]*\r\n/i";classtype:attempted-recon;sid:9000004; rev:1;)

#RTSP5 (To be checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET $RTSP_PORTS (msg:"RTSP overlong Session/X-Header - possible header parsing overflow/poisoning attempt";flow:to_server,established;content:"RTSP/1."; nocase;content:"Session:"; nocase; distance:0; within:200;pcre:"/(?:\r\n|^)\s*(?:Session|X-RTSP-Session):\s*[A-Za-z0-9+\/=]{120,}/smi";classtype:attempted-admin;sid:9000005; rev:2;)


###################################################


#Telnet 1 MVPower DVR Backdoor (to be checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET 23 (msg:"MVPower DVR Backdoor-Zugriff (/shell)"; flow:to_server, established; http.uri; content:"/shell"; reference:cve,2016-20016; classtype:attempted-admin; sid:9000006; rev:2;)

#Telnet 2 IoT-Gerät als DDoS Bot (checked)
alert udp $HOME_NET any -> $EXTERNAL_NET any (msg:"IoT moeglicher UDP-Flood (DDoS-Bot)"; threshold: type both, track by_src, count 100, seconds 1; classtype:attempted-dos; sid:9000007; rev:1;)

#Telnet 3 Internal Network Scanning (checked)
alert tcp $HOME_NET any -> $HOME_NET any (msg:"Internes Portscan durch IoT-Geraet"; flags:S; threshold: type both, track by_src, count 10, seconds 60; classtype:attempted-recon; sid:9000008; rev:1;)


###################################################


#Router 1 D-Link Command Injection (to be checked)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"D-Link DSL-2750B login.cgi Command Injection"; flow:to_server; content:"/login.cgi??cli=ls"; http.uri; pcre:"/cli=.*(?:|3B||%3[Bb]|%26)/U"; classtype:web-application-attack; sid:9000009; rev:13;)

#Router 2 GPON Router Auth Bypass (checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET 80 (msg:"Dasan GPON Auth-Bypass ?images"; flow:to_server; http.uri; content:"?images"; nocase; reference:cve,2018-10561; classtype:attempted-admin; sid:9000010; rev:1;)

#Router 3 TR-064 WAN Shell Injection (checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET 7547 (msg:"TR-064 NewNTPServer Command Injection (pkt_data)"; flow:to_server,established; content:"NewNTPServer"; nocase; pkt_data; content:"http://"; nocase; classtype:attempted-admin; sid:9000011; rev:5;)

#Router 4a TOTOLINK A3000RU with Typo (checked)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "Router – TOTOLINK DownloadFlile.cgi Command Injection (CVE-2022-25082)"; flow: to_server, established; content: "GET /cgi-bin/downloadFlile.cgi"; http_request_line; content: "?"; http_request_line; pcre: "/(?:%3B|3B|\||&|`|%60)/i"; http_request_line; sid:9000012; rev:1;)

#Router 4b TOTOLINK A3000RU with Typo - DROP (checked)
drop http $EXTERNAL_NET any -> $HOME_NET any (msg: "Router – TOTOLINK DownloadFlile.cgi Command Injection (CVE-2022-25082)"; flow: to_server, established; content: "GET /cgi-bin/downloadFlile.cgi"; http_request_line; content: "?"; http_request_line; pcre: "/(?:%3B|3B|\||&|`|%60)/i"; http_request_line; sid:9000013; rev:1;)

#Router 4c TOTOLINK A3000RU without Typo
alert http $EXTERNAL_NET any -> $HOME_NET any (msg: "Router – TOTOLINK DownloadFile.cgi Command Injection (CVE-2022-25082)"; flow: to_server, established; content: "GET /cgi-bin/downloadFile.cgi"; http_request_line; content: "?"; http_request_line; pcre: "/(?:%3B|3B|\||&|`|%60)/i"; http_request_line; sid:9000014; rev:1;)

#Router 5 TP-Link Archer AX21 (checked)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"IoT RCE-Versuch TP-Link Archer AX21 (country Param) CVE-2023-1389";flow:to_server,established;http.uri;content:"country="; nocase;pcre:"/country=[^\r\n ]*(?:\x3B|%3[Bb]|`)/i";classtype:attempted-admin;sid:9000015; rev:4;)

#Router 6 Tenda AC18 (checked)
alert http any any -> $HOME_NET 80 (msg:"IoT RCE-Versuch Tenda AC18 (WriteFacMac) CVE-2022-31446";flow:to_server,established;http.uri;content:"/goform/WriteFacMac"; nocase;http.uri; content:"mac="; nocase;pcre:"/mac=[0-9A-Fa-f:%-]*?(?:\x3B|%3[Bb]|`)/";classtype:attempted-admin; sid:9000016; rev:2;)

#Router 7 APSystems ECU-R (checked)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"IoT-Energy - APSystems ECU-R timezone Command Injection (encoded %3B)"; flow:to_server,established; content:"timezone="; http_client_body; content:"%3B"; http_client_body; nocase; classtype:attempted-admin; sid:9000017; rev:4;)


###################################################


#Cam 1 HTTP Login with default credentials (checked)
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"IoT Web-Login mit Default-Passwort (BasicAuth)"; flow:to_server, established; content:"Authorization: Basic "; content:"YWRtaW46YWRtaW4="; classtype:attempted-admin; sid:9000018; rev:1;)

#Cam 2 IP-Cam Configuration Leak (checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET 80 (msg:"IP-Cam Config Leak (system.ini Download)"; flow:to_server; content:"GET /system.ini HTTP/1.1"; nocase; classtype:attempted-recon; sid:9000019; rev:1;)

#Cam3
alert http $EXTERNAL_NET any -> $HOME_NET 80 (msg:"CAM ONVIF CreateUsers with UsernameToken/ReplayNonce suspicious";flow:to_server,established;content:"/onvif/device_service"; http_uri; nocase;content:"POST"; http_method; depth:4;pkt_data;content:"<CreateUsers"; http_client_body; nocase;content:"UsernameToken"; http_client_body; nocase;content:"Nonce"; http_client_body; nocase;pcre:"/[A-Za-z0-9+\/=]{30,}/";classtype:attempted-admin;sid:9000020;rev:4;)

#Cam4
alert http $EXTERNAL_NET any -> $HOME_NET any (msg:"CAM res.php suspicious action=alarm with shell delimiter (possible command injection) - encoded aware";flow:to_server,established;content:"/res.php"; nocase; http_uri; content:"POST"; http_method; depth:4;pkt_data;content:"action=alarm"; http.request_body; pcre:"/([\;&`|]\s*\w+|%3[Bb]\s*\w+|%7[Cc]\s*\w+|%60\s*\w+)/i";classtype:attempted-admin;sid:9000021;rev:1;)


###################################################


#MQTT 1 Externer MQTT Zugriffsversuch (checked)
alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"MQTT CONNECT (external)"; flow:to_server,established; mqtt.type:connect; classtype:attempted-recon; sid:9000022; rev:1;)

#MQTT 2 MQTT Connect Flood
alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"MQTT Connect Flood/Bruteforce"; flow:to_server; mqtt.type:connect; threshold:type both, track by_src, count 5, seconds 60; classtype:attempted-dos; sid:9000023; rev:1;)

#MQTT 3 NEW 
alert tcp $EXTERNAL_NET any -> $HOME_NET 1883 (msg:"MQTT Publish to exec topic with debug command - possible remote command injection attempt";flow:to_server,established;content:"|30|"; offset:0; depth:1;pcre:"/acme\/device\/[^\/]+\/exec\/server/smi";pcre:"/debug\s+[A-Za-z0-9_\-\/\.\$]{1,200}/smi";classtype:attempted-admin;sid:9000024; rev:3;)


###################################################


#COAP 1
alert udp any any -> any 5683 (msg:"CoAP POST with cmd= payload";content:"|02|"; offset:1; depth:1;pcre:"/\xFFcmd=[A-Za-z0-9_\-\/\.\$&=]{1,200}/i";classtype:attempted-admin;sid:9000025; rev:2;)